<%- include('header') %>
<h2>Bookings</h2>

<form method="GET" action="/search" style="margin:20px 0; padding:15px; background:#f8f9fa; border-radius:8px;">
  <input type="text" name="name" placeholder="Name" value="<%= (search && search.name) || '' %>" style="margin:5px; padding:8px;">
  <input type="text" name="phone" placeholder="Phone" value="<%= (search && search.phone) || '' %>" style="margin:5px; padding:8px;">

  <!-- Date input as text + formatted as yyyy/MM/dd -->
  <input 
    type="text" 
    name="date" 
    placeholder="yyyy/MM/dd" 
    value="<%= (search && search.date) ? new Date(search.date).toISOString().split('T')[0].replace(/-/g, '/') : '' %>"
    pattern="\d{4}/\d{2}/\d{2}"
    style="margin:5px; padding:8px; width:130px;"
  >

  <input type="number" name="pax" placeholder="Pax" min="1" value="<%= (search && search.pax) || '' %>" style="margin:5px; padding:8px;">
  <button type="submit" style="padding:8px 16px; background:#1abc9c; color:white; border:none; border-radius:4px;">Search</button>
  <a href="/" style="margin-left:10px; color:#e74c3c; text-decoration:none;">Clear</a>
</form>

<!-- Auto-convert yyyy/MM/dd â†’ yyyy-MM-dd before submit (so MongoDB understands) -->
<script>
  document.querySelector('form').addEventListener('submit', function() {
    const dateInput = this.querySelector('input[name="date"]');
    if (dateInput.value.trim()) {
      dateInput.value = dateInput.value.trim().replace(/\//g, '-');
    }
  });
</script>

<table border="1" style="width:100%; border-collapse:collapse;">
  <tr style="background:#2c3e50; color:white;">
    <th>Name</th><th>Phone</th><th>Date</th><th>Time</th><th>Pax</th><th>Actions</th>
  </tr>
  <% if (!bookings || bookings.length === 0) { %>
    <tr><td colspan="6" style="text-align:center; padding:20px; color:#777;">No bookings found.</td></tr>
  <% } else { %>
    <% bookings.forEach(b => { %>
      <tr>
        <td><%= b.name %></td>
        <td><%= b.phone %></td>
        <!-- This line formats the date as yyyy/MM/dd -->
        <td><%= new Date(b.date).toISOString().split('T')[0].replace(/-/g, '/') %></td>
        <td><%= b.time %></td>
        <td><%= b.pax %></td>
        <td>
          <a href="/details/<%= b._id %>">View</a> |
          <a href="/edit/<%= b._id %>">Edit</a> |
          <a href="/delete/<%= b._id %>" onclick="return confirm('Delete?')">Delete</a>
        </td>
      </tr>
    <% }) %>
  <% } %>
</table>
